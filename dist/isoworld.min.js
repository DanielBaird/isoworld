/*! isoworld v0.0.1 | (c) 2014 Daniel Baird | blah licence */
!function(t){if("object"==typeof exports)module.exports=t();else if("function"==typeof define&&define.amd)define(t);else{var o;"undefined"!=typeof window?o=window:"undefined"!=typeof global?o=global:"undefined"!=typeof self&&(o=self),o.isoworld=t()}}(function(){return function t(o,e,n){function r(s,a){if(!e[s]){if(!o[s]){var h="function"==typeof require&&require;if(!a&&h)return h(s,!0);if(i)return i(s,!0);throw new Error("Cannot find module '"+s+"'")}var l=e[s]={exports:{}};o[s][0].call(l.exports,function(t){var e=o[s][1][t];return r(e?e:t)},l,l.exports,t,o,e,n)}return e[s].exports}for(var i="function"==typeof require&&require,s=0;s<n.length;s++)r(n[s]);return r}({1:[function(t,o){o.exports=t("./js/isomer")},{"./js/isomer":4}],2:[function(t,o){function e(t){this.elem=t,this.ctx=this.elem.getContext("2d"),this.width=t.width,this.height=t.height}e.prototype.clear=function(){this.ctx.clearRect(0,0,this.width,this.height)},e.prototype.path=function(t,o){this.ctx.beginPath(),this.ctx.moveTo(t[0].x,t[0].y);for(var e=1;e<t.length;e++)this.ctx.lineTo(t[e].x,t[e].y);this.ctx.closePath(),this.ctx.save(),this.ctx.globalAlpha=o.a,this.ctx.fillStyle=this.ctx.strokeStyle=o.toHex(),this.ctx.stroke(),this.ctx.fill(),this.ctx.restore()},o.exports=e},{}],3:[function(t,o){function e(t,o,e,n){this.r=parseInt(t||0),this.g=parseInt(o||0),this.b=parseInt(e||0),this.a=parseFloat(Math.round(100*n)/100||1),this.loadHSL()}e.prototype.toHex=function(){var t=(256*this.r*256+256*this.g+this.b).toString(16);return t.length<6&&(t=new Array(6-t.length+1).join("0")+t),"#"+t},e.prototype.lighten=function(t,o){o=o||new e(255,255,255);var n=new e(o.r/255*this.r,o.g/255*this.g,o.b/255*this.b,this.a);return n.l=Math.min(n.l+t,1),n.loadRGB(),n},e.prototype.loadHSL=function(){var t,o,e=this.r/255,n=this.g/255,r=this.b/255,i=Math.max(e,n,r),s=Math.min(e,n,r),a=(i+s)/2;if(i===s)t=o=0;else{var h=i-s;switch(o=a>.5?h/(2-i-s):h/(i+s),i){case e:t=(n-r)/h+(r>n?6:0);break;case n:t=(r-e)/h+2;break;case r:t=(e-n)/h+4}t/=6}this.h=t,this.s=o,this.l=a},e.prototype.loadRGB=function(){var t,o,e,n=this.h,r=this.s,i=this.l;if(0===r)t=o=e=i;else{var s=.5>i?i*(1+r):i+r-i*r,a=2*i-s;t=this._hue2rgb(a,s,n+1/3),o=this._hue2rgb(a,s,n),e=this._hue2rgb(a,s,n-1/3)}this.r=parseInt(255*t),this.g=parseInt(255*o),this.b=parseInt(255*e)},e.prototype._hue2rgb=function(t,o,e){return 0>e&&(e+=1),e>1&&(e-=1),1/6>e?t+6*(o-t)*e:.5>e?o:2/3>e?t+(o-t)*(2/3-e)*6:t},o.exports=e},{}],4:[function(t,o){function e(t,o){o=o||{},this.canvas=new n(t),this.angle=o.angle||Math.PI/6,this.scale=o.scale||70,this._calculateTransformation(),this.originX=o.originX||this.canvas.width/2,this.originY=o.originY||.9*this.canvas.height,this.lightPosition=o.lightPosition||new h(2,-1,3),this.lightAngle=this.lightPosition.normalize(),this.colorDifference=.2,this.lightColor=o.lightColor||new r(255,255,255)}var n=t("./canvas"),r=t("./color"),i=t("./path"),s=t("./point"),a=t("./shape"),h=t("./vector");e.prototype.setLightPosition=function(t,o,e){this.lightPosition=new h(t,o,e),this.lightAngle=this.lightPosition.normalize()},e.prototype._translatePoint=function(t){var o=new s(t.x*this.transformation[0][0],t.x*this.transformation[0][1]),e=new s(t.y*this.transformation[1][0],t.y*this.transformation[1][1]),n=this.originX+o.x+e.x,r=this.originY-o.y-e.y-t.z*this.scale;return new s(n,r)},e.prototype.add=function(t,o){if("[object Array]"==Object.prototype.toString.call(t))for(var e=0;e<t.length;e++)this.add(t[e],o);else if(t instanceof i)this._addPath(t,o);else if(t instanceof a){var n=t.orderedPaths();for(var e in n)this._addPath(n[e],o)}},e.prototype._addPath=function(t,o){o=o||new r(120,120,120);var e=h.fromTwoPoints(t.points[1],t.points[0]),n=h.fromTwoPoints(t.points[2],t.points[1]),i=h.crossProduct(e,n).normalize(),s=h.dotProduct(i,this.lightAngle);color=o.lighten(s*this.colorDifference,this.lightColor),this.canvas.path(t.points.map(this._translatePoint.bind(this)),color)},e.prototype._calculateTransformation=function(){this.transformation=[[this.scale*Math.cos(this.angle),this.scale*Math.sin(this.angle)],[this.scale*Math.cos(Math.PI-this.angle),this.scale*Math.sin(Math.PI-this.angle)]]},e.Canvas=n,e.Color=r,e.Path=i,e.Point=s,e.Shape=a,e.Vector=h,o.exports=e},{"./canvas":2,"./color":3,"./path":5,"./point":6,"./shape":7,"./vector":8}],5:[function(t,o){function e(t){this.points="[object Array]"===Object.prototype.toString.call(t)?t:Array.prototype.slice.call(arguments)}var n=t("./point");e.prototype.push=function(t){this.points.push(t)},e.prototype.reverse=function(){var t=Array.prototype.slice.call(this.points);return new e(t.reverse())},e.prototype.translate=function(){var t=arguments;return new e(this.points.map(function(o){return o.translate.apply(o,t)}))},e.prototype.rotateZ=function(){var t=arguments;return new e(this.points.map(function(o){return o.rotateZ.apply(o,t)}))},e.prototype.scale=function(){var t=arguments;return new e(this.points.map(function(o){return o.scale.apply(o,t)}))},e.prototype.depth=function(){var t,o=0;for(t=0;t<this.points.length;t++)o+=this.points[t].depth();return o/(this.points.length||1)},e.Rectangle=function(t,o,r){void 0===o&&(o=1),void 0===r&&(r=1);var i=new e([t,new n(t.x+o,t.y,t.z),new n(t.x+o,t.y+r,t.z),new n(t.x,t.y+r,t.z)]);return i},e.Circle=function(t,o,r){r=r||20;var i,s=new e;for(i=0;r>i;i++)s.push(new n(o*Math.cos(2*i*Math.PI/r),o*Math.sin(2*i*Math.PI/r),0));return s.translate(t.x,t.y,t.z)},e.Star=function(t,o,r,i){var s,a,h=new e;for(s=0;2*i>s;s++)a=s%2===0?o:r,h.push(new n(a*Math.cos(s*Math.PI/i),a*Math.sin(s*Math.PI/i),0));return h.translate(t.x,t.y,t.z)},o.exports=e},{"./point":6}],6:[function(t,o){function e(t,o,n){return this instanceof e?(this.x="number"==typeof t?t:0,this.y="number"==typeof o?o:0,this.z="number"==typeof n?n:0,void 0):new e(t,o,n)}e.ORIGIN=new e(0,0,0),e.prototype.translate=function(t,o,n){return new e(this.x+t,this.y+o,this.z+n)},e.prototype.scale=function(t,o,e,n){var r=this.translate(-t.x,-t.y,-t.z);return void 0===e&&void 0===n?e=n=o:n="number"==typeof n?n:1,r.x*=o,r.y*=e,r.z*=n,r.translate(t.x,t.y,t.z)},e.prototype.rotateZ=function(t,o){var e=this.translate(-t.x,-t.y,-t.z),n=e.x*Math.cos(o)-e.y*Math.sin(o),r=e.x*Math.sin(o)+e.y*Math.cos(o);return e.x=n,e.y=r,e.translate(t.x,t.y,t.z)},e.prototype.depth=function(){return this.x+this.y-2*this.z},e.distance=function(t,o){var e=o.x-t.x,n=o.y-t.y,r=o.z-t.z;return Math.sqrt(e*e+n*n+r*r)},o.exports=e},{}],7:[function(t,o){function e(t){this.paths="[object Array]"===Object.prototype.toString.call(t)?t:Array.prototype.slice.call(arguments)}var n=t("./path"),r=t("./point");e.prototype.push=function(t){this.paths.push(t)},e.prototype.translate=function(){var t=arguments;return new e(this.paths.map(function(o){return o.translate.apply(o,t)}))},e.prototype.rotateZ=function(){var t=arguments;return new e(this.paths.map(function(o){return o.rotateZ.apply(o,t)}))},e.prototype.scale=function(){var t=arguments;return new e(this.paths.map(function(o){return o.scale.apply(o,t)}))},e.prototype.orderedPaths=function(){var t=this.paths.slice();return t.sort(function(t,o){return o.depth()-t.depth()})},e.extrude=function(t,o){o="number"==typeof o?o:1;var r,i=t.translate(0,0,o),s=new e;for(s.push(t.reverse()),s.push(i),r=0;r<t.points.length;r++)s.push(new n([i.points[r],t.points[r],t.points[(r+1)%t.points.length],i.points[(r+1)%i.points.length]]));return s},e.Prism=function(t,o,i,s){o="number"==typeof o?o:1,i="number"==typeof i?i:1,s="number"==typeof s?s:1;var a=new e,h=new n([t,new r(t.x+o,t.y,t.z),new r(t.x+o,t.y,t.z+s),new r(t.x,t.y,t.z+s)]);a.push(h),a.push(h.reverse().translate(0,i,0));var l=new n([t,new r(t.x,t.y,t.z+s),new r(t.x,t.y+i,t.z+s),new r(t.x,t.y+i,t.z)]);a.push(l),a.push(l.reverse().translate(o,0,0));var p=new n([t,new r(t.x+o,t.y,t.z),new r(t.x+o,t.y+i,t.z),new r(t.x,t.y+i,t.z)]);return a.push(p.reverse()),a.push(p.translate(0,0,s)),a},e.Pyramid=function(t,o,i,s){o="number"==typeof o?o:1,i="number"==typeof i?i:1,s="number"==typeof s?s:1;var a=new e,h=new n([t,new r(t.x+o,t.y,t.z),new r(t.x+o/2,t.y+i/2,t.z+s)]);a.push(h),a.push(h.rotateZ(t.translate(o/2,i/2),Math.PI));var l=new n([t,new r(t.x+o/2,t.y+i/2,t.z+s),new r(t.x,t.y+i,t.z)]);return a.push(l),a.push(l.rotateZ(t.translate(o/2,i/2),Math.PI)),a},e.Cylinder=function(t,o,r,i){o="number"==typeof o?o:1;var s=n.Circle(t,o,r),a=e.extrude(s,i);return a},o.exports=e},{"./path":5,"./point":6}],8:[function(t,o){function e(t,o,e){this.i="number"==typeof t?t:0,this.j="number"==typeof o?o:0,this.k="number"==typeof e?e:0}e.fromTwoPoints=function(t,o){return new e(o.x-t.x,o.y-t.y,o.z-t.z)},e.crossProduct=function(t,o){var n=t.j*o.k-o.j*t.k,r=-1*(t.i*o.k-o.i*t.k),i=t.i*o.j-o.i*t.j;return new e(n,r,i)},e.dotProduct=function(t,o){return t.i*o.i+t.j*o.j+t.k*o.k},e.prototype.magnitude=function(){return Math.sqrt(this.i*this.i+this.j*this.j+this.k*this.k)},e.prototype.normalize=function(){var t=this.magnitude();return new e(this.i/t,this.j/t,this.k/t)},o.exports=e},{}],9:[function(t,o){o.exports=t("./worlds/allworlds.js")},{"./worlds/allworlds.js":13}],10:[function(t,o){function e(t,o,e,n,r,i){this.x=t,this.y=o,this.z=e,this.w=n,this.h=r,this.color=i}var n=t("../../bower_components/isomer/index.js"),r=n.Point,i=n.Shape.Prism;e.prototype.dupe=function(){return new e(this.x,this.y,this.z,this.w,this.h,this.color)},e.prototype.translate=function(t,o,e){this.x+=t,this.y+=o,this.z+=e},e.prototype.render=function(t,o){var e=new r(this.x,this.y,this.z),n=this.w*(1-o.isoGap);t.add(new i(e,n,n,this.h),this.color)},o.exports=e},{"../../bower_components/isomer/index.js":1}],11:[function(t,o){function e(t,o,e,r,i){n.call(this,t,o,e,1,r,i)}var n=t("./block.js");e.prototype=Object.create(n.prototype),e.prototype.constructor=e,o.exports=e},{"./block.js":10}],12:[function(){"function"!=typeof Object.create&&!function(){var t=function(){};Object.create=function(o){if(arguments.length>1)throw Error("Second argument not supported");if(null===o)throw Error("Cannot set a null [[Prototype]]");if("object"!=typeof o)throw TypeError("Argument must be an object");return t.prototype=o,new t}}()},{}],13:[function(t,o){var e=t("./worlddefaults.js"),n=t("./forestworld.js"),r=t("../../bower_components/isomer/index.js"),i={defaultOptions:e,Color:r.Color,Forest:n};window.World=i,o.exports=i},{"../../bower_components/isomer/index.js":1,"./forestworld.js":15,"./worlddefaults.js":16}],14:[function(t,o){function e(t,o){this._opts=Object.create(r),this.mergeOptions(o),this._squares=this.initSquares(),this._groundStacks=[],this._groundHeight=[],this._layers=this.makeLayers(t),this._colors=i[this._opts.colorScheme],void 0===this._colors&&(this._colors={blank:new s.Color(255,75,75,.66)})}t("../util/shims.js");var n=t("./worlddefaults.js"),r=n.options,i=n.colorSchemes,s=t("../../bower_components/isomer/index.js"),a=t("../objects/unitcolumn.js");e.prototype.initSquares=function(){for(var t=[],o=this._opts,e=Math.ceil(o.worldSizeX/o.blockSize),n=Math.ceil(o.worldSizeY/o.blockSize),r=0;e>r;r++){t.push([]);for(var i=0;n>i;i++)t[r].push({x:r,y:i,z:0,ground:[],features:[]})}return t},e.prototype.getColor=function(t){if(t instanceof s.Color)return t;var o=this._colors[t];return o||(o=this._colors.blank),o},e.prototype.makeLayers=function(t){this._dom=t instanceof Element?t:document.getElementById(t);var o=this._dom.clientWidth,e=this._dom.clientHeight,n={scale:this._opts.isoScale,angle:this._opts.isoAngle};return this._dom.innerHTML='<style>.isoworld { position: absolute; top: 0, bottom: 0, left: 0, right: 0 }</style><canvas id="isoworld-bg" class="isoworld" width="'+o+'" height="'+e+'"></canvas><canvas id="isoworld-fg" class="isoworld" width="'+o+'" height="'+e+'"></canvas><canvas id="isoworld-ui" class="isoworld" width="'+o+'" height="'+e+'"></canvas>',{bg:new s(document.getElementById("isoworld-bg"),n),fg:new s(document.getElementById("isoworld-fg"),n),ui:new s(document.getElementById("isoworld-ui"),n)}},e.prototype.mergeOptions=function(t){for(opt in t)this._opts[opt]=t[opt]},e.prototype.autoRender=function(t){return t===!1?this._opts.autoRender=!1:1==t&&(this._opts.autoRender=!0),this._opts.autoRender},e.prototype.w2bVertical=function(t){var o=(t-this._opts.worldOriginZ)/this._opts.blockSize*this._opts.worldScaleZ;return o},e.prototype.w2b=function(t,o,e){var n=t,r=o,i=e;n instanceof Array&&(i=n[2],r=n[1],n=n[0]);var s=this._opts,a=Math.floor((n-s.worldOriginX)/s.blockSize),h=Math.floor((r-s.worldOriginY)/s.blockSize),l=(i-s.worldOriginZ)/s.blockSize*s.worldScaleZ;return[a,h,l]},e.prototype.groundLevel=function(t,o,e){var n=this.w2b(t,o,e),r=n[0],i=n[1],s=n[2];this.setGroundLevel(r,i,s),this.renderMaybe()},e.prototype.ground=function(t,o,e){var n,r,i,s,h=this.w2b(t,o,0),l=h[0],p=h[1],u=this._squares[l][p].z,c=u,f=[];if(e instanceof Array)for(n=0;n<e.length;n+=2)i=this.getColor(e[n]),r=n<e.length-1?this.w2bVertical(e[n+1]):c-this._opts.bedrockLevel,c-=r,s=new a(l,p,c,r,i),r>0&&f.unshift(s);else f.unshift(new a(l,p,this._opts.bedrockLevel,u-this._opts.bedrockLevel,this.getColor(e)));this.setGroundStack(l,p,f),this.renderMaybe()},e.prototype.validatePosition=function(t,o){var e=this._squares;return!(0>t||0>o||t>=e.length||o>=e[0].length)},e.prototype.setGroundLevel=function(t,o,e){this.validatePosition(t,o)&&(this._squares[t][o].z=e)},e.prototype.setGroundStack=function(t,o,e){this.validatePosition(t,o)&&(this._groundStacks.push({x:t,y:o,stack:e}),this._extrapolateGround())},e.prototype.renderSquare=function(t,o){var e=this._squares[t][o];if(void 0!==e)if(e.ground&&e.ground.length>0)for(layer in e.ground)e.ground[layer].render(this._layers.fg,this._opts);else this.renderBlankSquare(e)},e.prototype.renderBlankSquare=function(t){this._blankBlock||(this._blankBlock=new s.Shape.Prism(new s.Point(0,0,this._opts.bedrockLevel),1-this._opts.isoGap,1-this._opts.isoGap,0-this._opts.bedrockLevel));var o=1;t.z&&0!=t.z&&(o=(0-this._opts.bedrockLevel+t.z)/(0-this._opts.bedrockLevel)),this._layers.fg.add(this._blankBlock.scale(new s.Point(0,0,this._opts.bedrockLevel),1,1,o).translate(t.x,t.y,t.z),this.getColor("blank"))},e.prototype.render=function(){for(var t in this._layers)this._layers[t].canvas.clear();for(var o,e,n=this._squares,r=n.length,i=n[0].length,s=r+i-2;s>=0;){for(o=0;r>o;o++)for(e=0;i>e;e++)o+e==s&&n[o][e]&&this.renderSquare(o,e);s-=1}},e.prototype.renderMaybe=function(){this._autoRender&&this.render()},e.prototype._neighbours=function(t,o){for(var e=[],n=-1;1>=n;n++)for(var r=-1;1>=r;r++)(0!=n||0!=r)&&this.validatePosition(t+n,o+r)&&e.push({x:t+n,y:o+r});return e},e.prototype._copyGround=function(t,o){var e;o.ground=[];for(var n=0;n<t.ground.length;n++)e=t.ground[n].dupe(),e.translate(o.x-t.x,o.y-t.y,o.z-t.z),o.ground.push(e)},e.prototype._extrapolateGround=function(){var t,o,e,n=this._squares,r=n.length,i=n[0].length;for(t=0;r>t;t++)for(o=0;i>o;o++)n[t][o].ground=void 0;for(var s=0;s<this._groundStacks.length;s++)e=this._groundStacks[s],n[e.x][e.y].ground=e.stack;for(var a,h,l,p=1;p>0;)for(p=0,t=0;r>t;t++)for(o=0;i>o;o++)if(l=n[t][o],void 0!==l.ground){a=this._neighbours(t,o);for(var u=0;u<a.length;u++)h=n[a[u].x][a[u].y],void 0===h.ground&&(p++,this._copyGround(l,h))}this.renderMaybe()},o.exports=e},{"../../bower_components/isomer/index.js":1,"../objects/unitcolumn.js":11,"../util/shims.js":12,"./worlddefaults.js":16}],15:[function(t,o){function e(){n.apply(this,arguments)}t("../util/shims.js");var n=t("./baseworld.js");e.prototype=Object.create(n.prototype),e.prototype.constructor=e,o.exports=e},{"../util/shims.js":12,"./baseworld.js":14}],16:[function(t,o){var e=t("../../bower_components/isomer/index.js").Color,n={autoRender:!0,worldSizeX:10,worldSizeY:10,worldOriginX:0,worldOriginY:0,worldOriginZ:0,worldScaleZ:1,colorScheme:"bright",bedrockLevel:-10,blockSize:1,isoGap:.05,isoScale:60,isoAngle:Math.PI/8,dummy:"has no trailing comma"},r={bright:{blank:new e(180,180,180),soil:new e(110,50,35),leaflitter:new e(70,120,30),water:new e(50,200,255,.75),wood:new e(90,50,20,.66),highlight:new e(255,255,100,.1)},real:{blank:new e(125,125,125),soil:new e(50,40,30),leaflitter:new e(50,60,40),water:new e(50,150,255,.75),wood:new e(50,40,30,.66),highlight:new e(255,255,100,.1)}};o.exports={options:n,colorSchemes:r}},{"../../bower_components/isomer/index.js":1}]},{},[9])(9)});