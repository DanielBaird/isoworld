/*! isoworld v0.0.1 | (c) 2014 Daniel Baird | blah licence */
!function(t){if("object"==typeof exports)module.exports=t();else if("function"==typeof define&&define.amd)define(t);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.isoworld=t()}}(function(){return function t(e,o,n){function r(s,a){if(!o[s]){if(!e[s]){var h="function"==typeof require&&require;if(!a&&h)return h(s,!0);if(i)return i(s,!0);throw new Error("Cannot find module '"+s+"'")}var l=o[s]={exports:{}};e[s][0].call(l.exports,function(t){var o=e[s][1][t];return r(o?o:t)},l,l.exports,t,e,o,n)}return o[s].exports}for(var i="function"==typeof require&&require,s=0;s<n.length;s++)r(n[s]);return r}({1:[function(t,e){e.exports=t("./js/isomer")},{"./js/isomer":4}],2:[function(t,e){function o(t){this.elem=t,this.ctx=this.elem.getContext("2d"),this.width=t.width,this.height=t.height}o.prototype.clear=function(){this.ctx.clearRect(0,0,this.width,this.height)},o.prototype.path=function(t,e){this.ctx.beginPath(),this.ctx.moveTo(t[0].x,t[0].y);for(var o=1;o<t.length;o++)this.ctx.lineTo(t[o].x,t[o].y);this.ctx.closePath(),this.ctx.save(),this.ctx.globalAlpha=e.a,this.ctx.fillStyle=this.ctx.strokeStyle=e.toHex(),this.ctx.stroke(),this.ctx.fill(),this.ctx.restore()},e.exports=o},{}],3:[function(t,e){function o(t,e,o,n){this.r=parseInt(t||0),this.g=parseInt(e||0),this.b=parseInt(o||0),this.a=parseFloat(Math.round(100*n)/100||1),this.loadHSL()}o.prototype.toHex=function(){var t=(256*this.r*256+256*this.g+this.b).toString(16);return t.length<6&&(t=new Array(6-t.length+1).join("0")+t),"#"+t},o.prototype.lighten=function(t,e){e=e||new o(255,255,255);var n=new o(e.r/255*this.r,e.g/255*this.g,e.b/255*this.b,this.a);return n.l=Math.min(n.l+t,1),n.loadRGB(),n},o.prototype.loadHSL=function(){var t,e,o=this.r/255,n=this.g/255,r=this.b/255,i=Math.max(o,n,r),s=Math.min(o,n,r),a=(i+s)/2;if(i===s)t=e=0;else{var h=i-s;switch(e=a>.5?h/(2-i-s):h/(i+s),i){case o:t=(n-r)/h+(r>n?6:0);break;case n:t=(r-o)/h+2;break;case r:t=(o-n)/h+4}t/=6}this.h=t,this.s=e,this.l=a},o.prototype.loadRGB=function(){var t,e,o,n=this.h,r=this.s,i=this.l;if(0===r)t=e=o=i;else{var s=.5>i?i*(1+r):i+r-i*r,a=2*i-s;t=this._hue2rgb(a,s,n+1/3),e=this._hue2rgb(a,s,n),o=this._hue2rgb(a,s,n-1/3)}this.r=parseInt(255*t),this.g=parseInt(255*e),this.b=parseInt(255*o)},o.prototype._hue2rgb=function(t,e,o){return 0>o&&(o+=1),o>1&&(o-=1),1/6>o?t+6*(e-t)*o:.5>o?e:2/3>o?t+(e-t)*(2/3-o)*6:t},e.exports=o},{}],4:[function(t,e){function o(t,e){e=e||{},this.canvas=new n(t),this.angle=e.angle||Math.PI/6,this.scale=e.scale||70,this._calculateTransformation(),this.originX=e.originX||this.canvas.width/2,this.originY=e.originY||.9*this.canvas.height,this.lightPosition=e.lightPosition||new h(2,-1,3),this.lightAngle=this.lightPosition.normalize(),this.colorDifference=.2,this.lightColor=e.lightColor||new r(255,255,255)}var n=t("./canvas"),r=t("./color"),i=t("./path"),s=t("./point"),a=t("./shape"),h=t("./vector");o.prototype.setLightPosition=function(t,e,o){this.lightPosition=new h(t,e,o),this.lightAngle=this.lightPosition.normalize()},o.prototype._translatePoint=function(t){var e=new s(t.x*this.transformation[0][0],t.x*this.transformation[0][1]),o=new s(t.y*this.transformation[1][0],t.y*this.transformation[1][1]),n=this.originX+e.x+o.x,r=this.originY-e.y-o.y-t.z*this.scale;return new s(n,r)},o.prototype.add=function(t,e){if("[object Array]"==Object.prototype.toString.call(t))for(var o=0;o<t.length;o++)this.add(t[o],e);else if(t instanceof i)this._addPath(t,e);else if(t instanceof a){var n=t.orderedPaths();for(var o in n)this._addPath(n[o],e)}},o.prototype._addPath=function(t,e){e=e||new r(120,120,120);var o=h.fromTwoPoints(t.points[1],t.points[0]),n=h.fromTwoPoints(t.points[2],t.points[1]),i=h.crossProduct(o,n).normalize(),s=h.dotProduct(i,this.lightAngle);color=e.lighten(s*this.colorDifference,this.lightColor),this.canvas.path(t.points.map(this._translatePoint.bind(this)),color)},o.prototype._calculateTransformation=function(){this.transformation=[[this.scale*Math.cos(this.angle),this.scale*Math.sin(this.angle)],[this.scale*Math.cos(Math.PI-this.angle),this.scale*Math.sin(Math.PI-this.angle)]]},o.Canvas=n,o.Color=r,o.Path=i,o.Point=s,o.Shape=a,o.Vector=h,e.exports=o},{"./canvas":2,"./color":3,"./path":5,"./point":6,"./shape":7,"./vector":8}],5:[function(t,e){function o(t){this.points="[object Array]"===Object.prototype.toString.call(t)?t:Array.prototype.slice.call(arguments)}var n=t("./point");o.prototype.push=function(t){this.points.push(t)},o.prototype.reverse=function(){var t=Array.prototype.slice.call(this.points);return new o(t.reverse())},o.prototype.translate=function(){var t=arguments;return new o(this.points.map(function(e){return e.translate.apply(e,t)}))},o.prototype.rotateZ=function(){var t=arguments;return new o(this.points.map(function(e){return e.rotateZ.apply(e,t)}))},o.prototype.scale=function(){var t=arguments;return new o(this.points.map(function(e){return e.scale.apply(e,t)}))},o.prototype.depth=function(){var t,e=0;for(t=0;t<this.points.length;t++)e+=this.points[t].depth();return e/(this.points.length||1)},o.Rectangle=function(t,e,r){void 0===e&&(e=1),void 0===r&&(r=1);var i=new o([t,new n(t.x+e,t.y,t.z),new n(t.x+e,t.y+r,t.z),new n(t.x,t.y+r,t.z)]);return i},o.Circle=function(t,e,r){r=r||20;var i,s=new o;for(i=0;r>i;i++)s.push(new n(e*Math.cos(2*i*Math.PI/r),e*Math.sin(2*i*Math.PI/r),0));return s.translate(t.x,t.y,t.z)},o.Star=function(t,e,r,i){var s,a,h=new o;for(s=0;2*i>s;s++)a=s%2===0?e:r,h.push(new n(a*Math.cos(s*Math.PI/i),a*Math.sin(s*Math.PI/i),0));return h.translate(t.x,t.y,t.z)},e.exports=o},{"./point":6}],6:[function(t,e){function o(t,e,n){return this instanceof o?(this.x="number"==typeof t?t:0,this.y="number"==typeof e?e:0,this.z="number"==typeof n?n:0,void 0):new o(t,e,n)}o.ORIGIN=new o(0,0,0),o.prototype.translate=function(t,e,n){return new o(this.x+t,this.y+e,this.z+n)},o.prototype.scale=function(t,e,o,n){var r=this.translate(-t.x,-t.y,-t.z);return void 0===o&&void 0===n?o=n=e:n="number"==typeof n?n:1,r.x*=e,r.y*=o,r.z*=n,r.translate(t.x,t.y,t.z)},o.prototype.rotateZ=function(t,e){var o=this.translate(-t.x,-t.y,-t.z),n=o.x*Math.cos(e)-o.y*Math.sin(e),r=o.x*Math.sin(e)+o.y*Math.cos(e);return o.x=n,o.y=r,o.translate(t.x,t.y,t.z)},o.prototype.depth=function(){return this.x+this.y-2*this.z},o.distance=function(t,e){var o=e.x-t.x,n=e.y-t.y,r=e.z-t.z;return Math.sqrt(o*o+n*n+r*r)},e.exports=o},{}],7:[function(t,e){function o(t){this.paths="[object Array]"===Object.prototype.toString.call(t)?t:Array.prototype.slice.call(arguments)}var n=t("./path"),r=t("./point");o.prototype.push=function(t){this.paths.push(t)},o.prototype.translate=function(){var t=arguments;return new o(this.paths.map(function(e){return e.translate.apply(e,t)}))},o.prototype.rotateZ=function(){var t=arguments;return new o(this.paths.map(function(e){return e.rotateZ.apply(e,t)}))},o.prototype.scale=function(){var t=arguments;return new o(this.paths.map(function(e){return e.scale.apply(e,t)}))},o.prototype.orderedPaths=function(){var t=this.paths.slice();return t.sort(function(t,e){return e.depth()-t.depth()})},o.extrude=function(t,e){e="number"==typeof e?e:1;var r,i=t.translate(0,0,e),s=new o;for(s.push(t.reverse()),s.push(i),r=0;r<t.points.length;r++)s.push(new n([i.points[r],t.points[r],t.points[(r+1)%t.points.length],i.points[(r+1)%i.points.length]]));return s},o.Prism=function(t,e,i,s){e="number"==typeof e?e:1,i="number"==typeof i?i:1,s="number"==typeof s?s:1;var a=new o,h=new n([t,new r(t.x+e,t.y,t.z),new r(t.x+e,t.y,t.z+s),new r(t.x,t.y,t.z+s)]);a.push(h),a.push(h.reverse().translate(0,i,0));var l=new n([t,new r(t.x,t.y,t.z+s),new r(t.x,t.y+i,t.z+s),new r(t.x,t.y+i,t.z)]);a.push(l),a.push(l.reverse().translate(e,0,0));var p=new n([t,new r(t.x+e,t.y,t.z),new r(t.x+e,t.y+i,t.z),new r(t.x,t.y+i,t.z)]);return a.push(p.reverse()),a.push(p.translate(0,0,s)),a},o.Pyramid=function(t,e,i,s){e="number"==typeof e?e:1,i="number"==typeof i?i:1,s="number"==typeof s?s:1;var a=new o,h=new n([t,new r(t.x+e,t.y,t.z),new r(t.x+e/2,t.y+i/2,t.z+s)]);a.push(h),a.push(h.rotateZ(t.translate(e/2,i/2),Math.PI));var l=new n([t,new r(t.x+e/2,t.y+i/2,t.z+s),new r(t.x,t.y+i,t.z)]);return a.push(l),a.push(l.rotateZ(t.translate(e/2,i/2),Math.PI)),a},o.Cylinder=function(t,e,r,i){e="number"==typeof e?e:1;var s=n.Circle(t,e,r),a=o.extrude(s,i);return a},e.exports=o},{"./path":5,"./point":6}],8:[function(t,e){function o(t,e,o){this.i="number"==typeof t?t:0,this.j="number"==typeof e?e:0,this.k="number"==typeof o?o:0}o.fromTwoPoints=function(t,e){return new o(e.x-t.x,e.y-t.y,e.z-t.z)},o.crossProduct=function(t,e){var n=t.j*e.k-e.j*t.k,r=-1*(t.i*e.k-e.i*t.k),i=t.i*e.j-e.i*t.j;return new o(n,r,i)},o.dotProduct=function(t,e){return t.i*e.i+t.j*e.j+t.k*e.k},o.prototype.magnitude=function(){return Math.sqrt(this.i*this.i+this.j*this.j+this.k*this.k)},o.prototype.normalize=function(){var t=this.magnitude();return new o(this.i/t,this.j/t,this.k/t)},e.exports=o},{}],9:[function(t,e){e.exports=t("./worlds/allworlds.js")},{"./worlds/allworlds.js":14}],10:[function(t,e){function o(t,e,o,n,r,i){this.x=t,this.y=e,this.z=o,this.w=n,this.h=r,this.color=i}var n=t("../../bower_components/isomer/index.js"),r=n.Point,i=n.Shape.Prism;o.prototype.dupe=function(){return new o(this.x,this.y,this.z,this.w,this.h,this.color)},o.prototype.translate=function(t,e,o){this.x+=t,this.y+=e,this.z+=o},o.prototype.render=function(t,e){var o=new r(this.x,this.y,this.z),n=this.w*(1-e.isoGap);t.add(new i(o,n,n,this.h),this.color)},e.exports=o},{"../../bower_components/isomer/index.js":1}],11:[function(t,e){function o(t,e){this.w=t,this.c=e instanceof n.Color?e:new n.Color(255,255,0)}var n=t("../../bower_components/isomer/index.js"),r=n.Point;o.prototype.width=function(t){return void 0!==t&&(this.w=t),this.w},o.prototype.render=function(t,e){var o=new r(e[0],e[1],e[2]);t.add(new n.Path.Star(o,this.w/6,this.w/2,9),this.c)},e.exports=o},{"../../bower_components/isomer/index.js":1}],12:[function(t,e){function o(t,e,o,r,i){n.call(this,t,e,o,1,r,i)}var n=t("./block.js");o.prototype=Object.create(n.prototype),o.prototype.constructor=o,e.exports=o},{"./block.js":10}],13:[function(){"function"!=typeof Object.create&&!function(){var t=function(){};Object.create=function(e){if(arguments.length>1)throw Error("Second argument not supported");if(null===e)throw Error("Cannot set a null [[Prototype]]");if("object"!=typeof e)throw TypeError("Argument must be an object");return t.prototype=e,new t}}()},{}],14:[function(t,e){var o=t("./worlddefaults.js"),n=t("./forestworld.js"),r=t("../../bower_components/isomer/index.js"),i={defaultOptions:o,Color:r.Color,Forest:n};window.World=i,e.exports=i},{"../../bower_components/isomer/index.js":1,"./forestworld.js":16,"./worlddefaults.js":17}],15:[function(t,e){function o(t,e){this._opts=Object.create(r),this.mergeOptions(e),this._squares=this.initSquares(),this._groundStacks=[],this._groundHeight=[],this._layers=this.makeLayers(t),this._colors=i[this._opts.colorScheme],void 0===this._colors&&(this._colors={blank:new s.Color(255,75,75,.66)})}t("../util/shims.js");var n=t("./worlddefaults.js"),r=n.options,i=n.colorSchemes,s=t("../../bower_components/isomer/index.js"),a=t("../objects/unitcolumn.js"),h=t("../objects/feature.js");o.prototype.initSquares=function(){for(var t=[],e=this._opts,o=Math.ceil(e.worldSizeX/e.blockSize),n=Math.ceil(e.worldSizeY/e.blockSize),r=0;o>r;r++){t.push([]);for(var i=0;n>i;i++)t[r].push({x:r,y:i,z:0,ground:[],features:[]})}return t},o.prototype.getColor=function(t){if(t instanceof s.Color)return t;var e=this._colors[t];return e||(e=this._colors.blank),e},o.prototype.makeLayers=function(t){this._dom=t instanceof Element?t:document.getElementById(t);var e=this._dom.clientWidth,o=this._dom.clientHeight,n={scale:this._opts.isoScale,angle:this._opts.isoAngle};return this._dom.innerHTML='<style>.isoworld { position: absolute; top: 0, bottom: 0, left: 0, right: 0 }</style><canvas id="isoworld-bg" class="isoworld" width="'+e+'" height="'+o+'"></canvas><canvas id="isoworld-fg" class="isoworld" width="'+e+'" height="'+o+'"></canvas><canvas id="isoworld-ui" class="isoworld" width="'+e+'" height="'+o+'"></canvas>',{bg:new s(document.getElementById("isoworld-bg"),n),fg:new s(document.getElementById("isoworld-fg"),n),ui:new s(document.getElementById("isoworld-ui"),n)}},o.prototype.mergeOptions=function(t){for(opt in t)this._opts[opt]=t[opt]},o.prototype.autoRender=function(t){return t===!1?this._opts.autoRender=!1:1==t&&(this._opts.autoRender=!0),this._opts.autoRender},o.prototype.w2bVertical=function(t){var e=(t-this._opts.worldOriginZ)/this._opts.blockSize*this._opts.worldScaleZ;return e},o.prototype.w2b=function(t,e,o){var n=t,r=e,i=o;n instanceof Array&&(i=n[2],r=n[1],n=n[0]);var s=this._opts,a=Math.floor((n-s.worldOriginX)/s.blockSize),h=Math.floor((r-s.worldOriginY)/s.blockSize),l=(i-s.worldOriginZ)/s.blockSize*s.worldScaleZ;return[a,h,l]},o.prototype.feature=function(t,e,o){var n=this.w2b(t,e,0),r=n[0],i=n[1];o||(o=new h(.5)),this._squares[r][i].features.push(o),this.renderMaybe()},o.prototype.groundLevel=function(t,e,o){var n=this.w2b(t,e,o),r=n[0],i=n[1],s=n[2];console.log("ground level at "+t+", "+e+" is "+o+" -> "+s),this.setGroundLevel(r,i,s),this.renderMaybe()},o.prototype.ground=function(t,e,o){var n,r,i,s,h=this.w2b(t,e,0),l=h[0],p=h[1],u=this._squares[l][p].z,c=u,f=[];if(o instanceof Array)for(n=0;n<o.length;n+=2)i=this.getColor(o[n]),r=n<o.length-1?this.w2bVertical(o[n+1]):c-this.w2bVertical(this._opts.bedrockLevel),console.log("layer thickness of "+o[n]+" is "+r),r>0&&(c-=r,s=new a(l,p,c,r,i),f.unshift(s));else f.unshift(new a(l,p,this.w2bVertical(this._opts.bedrockLevel),u-this.w2bVertical(this._opts.bedrockLevel),this.getColor(o)));this.setGroundStack(l,p,f),this.renderMaybe()},o.prototype.validatePosition=function(t,e){var o=this._squares;return!(0>t||0>e||t>=o.length||e>=o[0].length)},o.prototype.setGroundLevel=function(t,e,o){this.validatePosition(t,e)&&(this._squares[t][e].z=o)},o.prototype.setGroundStack=function(t,e,o){this.validatePosition(t,e)&&(this._groundStacks.push({x:t,y:e,ground:o}),this._extrapolateGround())},o.prototype.renderSquare=function(t,e){var o=this._squares[t][e];if(void 0!==o){if(o.ground&&o.ground.length>0){for(layer in o.ground)o.ground[layer].render(this._layers.fg,this._opts);console.log(o.z,o.ground[o.ground.length-1])}else this.renderBlankSquare(o);for(var n,r,n=0;n<o.features.length;n++)r=o.features[n],console.log(o.z,r),r.render(this._layers.fg,[t+.5,e+.5,o.z],this._opts)}},o.prototype.renderBlankSquare=function(t){this._layers.fg.add(new s.Shape.Prism(new s.Point(t.x,t.y,this._opts.bedrockLevel),1-this._opts.isoGap,1-this._opts.isoGap,0-this._opts.bedrockLevel+(t.z?t.z:0)),this.getColor("blank"))},o.prototype.render=function(){for(var t in this._layers)this._layers[t].canvas.clear();for(var e,o,n=this._squares,r=n.length,i=n[0].length,s=r+i-2;s>=0;){for(e=0;r>e;e++)for(o=0;i>o;o++)e+o==s&&n[e][o]&&this.renderSquare(e,o);s-=1}},o.prototype.renderMaybe=function(){this._autoRender&&this.render()},o.prototype._neighbours=function(t,e){for(var o=[],n=-1;1>=n;n++)for(var r=-1;1>=r;r++)(0!=n||0!=r)&&this.validatePosition(t+n,e+r)&&o.push({x:t+n,y:e+r});return o},o.prototype._copyGround=function(t,e){var o,n=t.z;void 0===n&&(n=0),e.ground=[];for(var r=0;r<t.ground.length;r++)o=t.ground[r].dupe(),o.translate(e.x-t.x,e.y-t.y,e.z-n),e.ground.push(o)},o.prototype._extrapolateGround=function(){"use strict";var t,e,o,n,r,i,s,a,h,l=this._squares,p=l.length,u=l[0].length;for(t=0;p>t;t++)for(e=0;u>e;e++){for(h=void 0,s=p*p+u*u,r=0;r<this._groundStacks.length;r++)a=this._groundStacks[r],o=t-a.x,n=e-a.y,i=o*o+n*n,s>i&&(s=i,h=a);h&&this._copyGround(h,this._squares[t][e])}this.renderMaybe()},e.exports=o},{"../../bower_components/isomer/index.js":1,"../objects/feature.js":11,"../objects/unitcolumn.js":12,"../util/shims.js":13,"./worlddefaults.js":17}],16:[function(t,e){function o(){n.apply(this,arguments)}t("../util/shims.js");var n=t("./baseworld.js");o.prototype=Object.create(n.prototype),o.prototype.constructor=o,e.exports=o},{"../util/shims.js":13,"./baseworld.js":15}],17:[function(t,e){var o=t("../../bower_components/isomer/index.js").Color,n={autoRender:!0,worldSizeX:10,worldSizeY:10,worldOriginX:0,worldOriginY:0,worldOriginZ:0,worldScaleZ:1,colorScheme:"bright",bedrockLevel:-3,blockSize:1,isoGap:.05,isoScale:60,isoAngle:Math.PI/8,dummy:"has no trailing comma"},r={bright:{blank:new o(180,180,180),soil:new o(110,50,35),sand:new o(230,200,20),leaflitter:new o(90,110,50),water:new o(50,200,255,.75),wood:new o(90,50,20,.66),highlight:new o(255,255,100,.1)},real:{blank:new o(125,125,125),soil:new o(50,40,30),sand:new o(210,190,120),leaflitter:new o(50,60,40),water:new o(50,150,255,.75),wood:new o(50,40,30,.66),highlight:new o(255,255,100,.1)}};e.exports={options:n,colorSchemes:r}},{"../../bower_components/isomer/index.js":1}]},{},[9])(9)});