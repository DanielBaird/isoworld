/*! isoworld v0.0.1 | (c) 2014 Daniel Baird | blah licence */
!function(t){if("object"==typeof exports)module.exports=t();else if("function"==typeof define&&define.amd)define(t);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.isoworld=t()}}(function(){return function t(e,o,n){function r(i,a){if(!o[i]){if(!e[i]){var h="function"==typeof require&&require;if(!a&&h)return h(i,!0);if(s)return s(i,!0);throw new Error("Cannot find module '"+i+"'")}var p=o[i]={exports:{}};e[i][0].call(p.exports,function(t){var o=e[i][1][t];return r(o?o:t)},p,p.exports,t,e,o,n)}return o[i].exports}for(var s="function"==typeof require&&require,i=0;i<n.length;i++)r(n[i]);return r}({1:[function(t,e){e.exports=t("./js/isomer")},{"./js/isomer":4}],2:[function(t,e){function o(t){this.elem=t,this.ctx=this.elem.getContext("2d"),this.width=t.width,this.height=t.height}o.prototype.clear=function(){this.ctx.clearRect(0,0,this.width,this.height)},o.prototype.path=function(t,e){this.ctx.beginPath(),this.ctx.moveTo(t[0].x,t[0].y);for(var o=1;o<t.length;o++)this.ctx.lineTo(t[o].x,t[o].y);this.ctx.closePath(),this.ctx.save(),this.ctx.globalAlpha=e.a,this.ctx.fillStyle=this.ctx.strokeStyle=e.toHex(),this.ctx.stroke(),this.ctx.fill(),this.ctx.restore()},e.exports=o},{}],3:[function(t,e){function o(t,e,o,n){this.r=parseInt(t||0),this.g=parseInt(e||0),this.b=parseInt(o||0),this.a=parseFloat(Math.round(100*n)/100||1),this.loadHSL()}o.prototype.toHex=function(){var t=(256*this.r*256+256*this.g+this.b).toString(16);return t.length<6&&(t=new Array(6-t.length+1).join("0")+t),"#"+t},o.prototype.lighten=function(t,e){e=e||new o(255,255,255);var n=new o(e.r/255*this.r,e.g/255*this.g,e.b/255*this.b,this.a);return n.l=Math.min(n.l+t,1),n.loadRGB(),n},o.prototype.loadHSL=function(){var t,e,o=this.r/255,n=this.g/255,r=this.b/255,s=Math.max(o,n,r),i=Math.min(o,n,r),a=(s+i)/2;if(s===i)t=e=0;else{var h=s-i;switch(e=a>.5?h/(2-s-i):h/(s+i),s){case o:t=(n-r)/h+(r>n?6:0);break;case n:t=(r-o)/h+2;break;case r:t=(o-n)/h+4}t/=6}this.h=t,this.s=e,this.l=a},o.prototype.loadRGB=function(){var t,e,o,n=this.h,r=this.s,s=this.l;if(0===r)t=e=o=s;else{var i=.5>s?s*(1+r):s+r-s*r,a=2*s-i;t=this._hue2rgb(a,i,n+1/3),e=this._hue2rgb(a,i,n),o=this._hue2rgb(a,i,n-1/3)}this.r=parseInt(255*t),this.g=parseInt(255*e),this.b=parseInt(255*o)},o.prototype._hue2rgb=function(t,e,o){return 0>o&&(o+=1),o>1&&(o-=1),1/6>o?t+6*(e-t)*o:.5>o?e:2/3>o?t+(e-t)*(2/3-o)*6:t},e.exports=o},{}],4:[function(t,e){function o(t,e){e=e||{},this.canvas=new n(t),this.angle=e.angle||Math.PI/6,this.scale=e.scale||70,this._calculateTransformation(),this.originX=e.originX||this.canvas.width/2,this.originY=e.originY||.9*this.canvas.height,this.lightPosition=e.lightPosition||new h(2,-1,3),this.lightAngle=this.lightPosition.normalize(),this.colorDifference=.2,this.lightColor=e.lightColor||new r(255,255,255)}var n=t("./canvas"),r=t("./color"),s=t("./path"),i=t("./point"),a=t("./shape"),h=t("./vector");o.prototype.setLightPosition=function(t,e,o){this.lightPosition=new h(t,e,o),this.lightAngle=this.lightPosition.normalize()},o.prototype._translatePoint=function(t){var e=new i(t.x*this.transformation[0][0],t.x*this.transformation[0][1]),o=new i(t.y*this.transformation[1][0],t.y*this.transformation[1][1]),n=this.originX+e.x+o.x,r=this.originY-e.y-o.y-t.z*this.scale;return new i(n,r)},o.prototype.add=function(t,e){if("[object Array]"==Object.prototype.toString.call(t))for(var o=0;o<t.length;o++)this.add(t[o],e);else if(t instanceof s)this._addPath(t,e);else if(t instanceof a){var n=t.orderedPaths();for(var o in n)this._addPath(n[o],e)}},o.prototype._addPath=function(t,e){e=e||new r(120,120,120);var o=h.fromTwoPoints(t.points[1],t.points[0]),n=h.fromTwoPoints(t.points[2],t.points[1]),s=h.crossProduct(o,n).normalize(),i=h.dotProduct(s,this.lightAngle);color=e.lighten(i*this.colorDifference,this.lightColor),this.canvas.path(t.points.map(this._translatePoint.bind(this)),color)},o.prototype._calculateTransformation=function(){this.transformation=[[this.scale*Math.cos(this.angle),this.scale*Math.sin(this.angle)],[this.scale*Math.cos(Math.PI-this.angle),this.scale*Math.sin(Math.PI-this.angle)]]},o.Canvas=n,o.Color=r,o.Path=s,o.Point=i,o.Shape=a,o.Vector=h,e.exports=o},{"./canvas":2,"./color":3,"./path":5,"./point":6,"./shape":7,"./vector":8}],5:[function(t,e){function o(t){this.points="[object Array]"===Object.prototype.toString.call(t)?t:Array.prototype.slice.call(arguments)}var n=t("./point");o.prototype.push=function(t){this.points.push(t)},o.prototype.reverse=function(){var t=Array.prototype.slice.call(this.points);return new o(t.reverse())},o.prototype.translate=function(){var t=arguments;return new o(this.points.map(function(e){return e.translate.apply(e,t)}))},o.prototype.rotateZ=function(){var t=arguments;return new o(this.points.map(function(e){return e.rotateZ.apply(e,t)}))},o.prototype.scale=function(){var t=arguments;return new o(this.points.map(function(e){return e.scale.apply(e,t)}))},o.prototype.depth=function(){var t,e=0;for(t=0;t<this.points.length;t++)e+=this.points[t].depth();return e/(this.points.length||1)},o.Rectangle=function(t,e,r){void 0===e&&(e=1),void 0===r&&(r=1);var s=new o([t,new n(t.x+e,t.y,t.z),new n(t.x+e,t.y+r,t.z),new n(t.x,t.y+r,t.z)]);return s},o.Circle=function(t,e,r){r=r||20;var s,i=new o;for(s=0;r>s;s++)i.push(new n(e*Math.cos(2*s*Math.PI/r),e*Math.sin(2*s*Math.PI/r),0));return i.translate(t.x,t.y,t.z)},o.Star=function(t,e,r,s){var i,a,h=new o;for(i=0;2*s>i;i++)a=i%2===0?e:r,h.push(new n(a*Math.cos(i*Math.PI/s),a*Math.sin(i*Math.PI/s),0));return h.translate(t.x,t.y,t.z)},e.exports=o},{"./point":6}],6:[function(t,e){function o(t,e,n){return this instanceof o?(this.x="number"==typeof t?t:0,this.y="number"==typeof e?e:0,this.z="number"==typeof n?n:0,void 0):new o(t,e,n)}o.ORIGIN=new o(0,0,0),o.prototype.translate=function(t,e,n){return new o(this.x+t,this.y+e,this.z+n)},o.prototype.scale=function(t,e,o,n){var r=this.translate(-t.x,-t.y,-t.z);return void 0===o&&void 0===n?o=n=e:n="number"==typeof n?n:1,r.x*=e,r.y*=o,r.z*=n,r.translate(t.x,t.y,t.z)},o.prototype.rotateZ=function(t,e){var o=this.translate(-t.x,-t.y,-t.z),n=o.x*Math.cos(e)-o.y*Math.sin(e),r=o.x*Math.sin(e)+o.y*Math.cos(e);return o.x=n,o.y=r,o.translate(t.x,t.y,t.z)},o.prototype.depth=function(){return this.x+this.y-2*this.z},o.distance=function(t,e){var o=e.x-t.x,n=e.y-t.y,r=e.z-t.z;return Math.sqrt(o*o+n*n+r*r)},e.exports=o},{}],7:[function(t,e){function o(t){this.paths="[object Array]"===Object.prototype.toString.call(t)?t:Array.prototype.slice.call(arguments)}var n=t("./path"),r=t("./point");o.prototype.push=function(t){this.paths.push(t)},o.prototype.translate=function(){var t=arguments;return new o(this.paths.map(function(e){return e.translate.apply(e,t)}))},o.prototype.rotateZ=function(){var t=arguments;return new o(this.paths.map(function(e){return e.rotateZ.apply(e,t)}))},o.prototype.scale=function(){var t=arguments;return new o(this.paths.map(function(e){return e.scale.apply(e,t)}))},o.prototype.orderedPaths=function(){var t=this.paths.slice();return t.sort(function(t,e){return e.depth()-t.depth()})},o.extrude=function(t,e){e="number"==typeof e?e:1;var r,s=t.translate(0,0,e),i=new o;for(i.push(t.reverse()),i.push(s),r=0;r<t.points.length;r++)i.push(new n([s.points[r],t.points[r],t.points[(r+1)%t.points.length],s.points[(r+1)%s.points.length]]));return i},o.Prism=function(t,e,s,i){e="number"==typeof e?e:1,s="number"==typeof s?s:1,i="number"==typeof i?i:1;var a=new o,h=new n([t,new r(t.x+e,t.y,t.z),new r(t.x+e,t.y,t.z+i),new r(t.x,t.y,t.z+i)]);a.push(h),a.push(h.reverse().translate(0,s,0));var p=new n([t,new r(t.x,t.y,t.z+i),new r(t.x,t.y+s,t.z+i),new r(t.x,t.y+s,t.z)]);a.push(p),a.push(p.reverse().translate(e,0,0));var l=new n([t,new r(t.x+e,t.y,t.z),new r(t.x+e,t.y+s,t.z),new r(t.x,t.y+s,t.z)]);return a.push(l.reverse()),a.push(l.translate(0,0,i)),a},o.Pyramid=function(t,e,s,i){e="number"==typeof e?e:1,s="number"==typeof s?s:1,i="number"==typeof i?i:1;var a=new o,h=new n([t,new r(t.x+e,t.y,t.z),new r(t.x+e/2,t.y+s/2,t.z+i)]);a.push(h),a.push(h.rotateZ(t.translate(e/2,s/2),Math.PI));var p=new n([t,new r(t.x+e/2,t.y+s/2,t.z+i),new r(t.x,t.y+s,t.z)]);return a.push(p),a.push(p.rotateZ(t.translate(e/2,s/2),Math.PI)),a},o.Cylinder=function(t,e,r,s){e="number"==typeof e?e:1;var i=n.Circle(t,e,r),a=o.extrude(i,s);return a},e.exports=o},{"./path":5,"./point":6}],8:[function(t,e){function o(t,e,o){this.i="number"==typeof t?t:0,this.j="number"==typeof e?e:0,this.k="number"==typeof o?o:0}o.fromTwoPoints=function(t,e){return new o(e.x-t.x,e.y-t.y,e.z-t.z)},o.crossProduct=function(t,e){var n=t.j*e.k-e.j*t.k,r=-1*(t.i*e.k-e.i*t.k),s=t.i*e.j-e.i*t.j;return new o(n,r,s)},o.dotProduct=function(t,e){return t.i*e.i+t.j*e.j+t.k*e.k},o.prototype.magnitude=function(){return Math.sqrt(this.i*this.i+this.j*this.j+this.k*this.k)},o.prototype.normalize=function(){var t=this.magnitude();return new o(this.i/t,this.j/t,this.k/t)},e.exports=o},{}],9:[function(t,e){"use strict";var o=t("./worlds/allworlds.js"),n=t("../bower_components/isomer/index.js");window.IsoWorld={Worlds:o,Point:n.Point,Color:n.Color},e.exports=window.IsoWorld},{"../bower_components/isomer/index.js":1,"./worlds/allworlds.js":23}],10:[function(t,e){function o(t,e,o,n,r,s){this.x=t,this.y=e,this.z=o,this.w=n,this.h=r,this.color=s}var n=t("../../bower_components/isomer/index.js"),r=n.Point,s=n.Shape.Prism;o.prototype.dupe=function(){return new o(this.x,this.y,this.z,this.w,this.h,this.color)},o.prototype.translate=function(t,e,o){this.x+=t,this.y+=e,this.z+=o},o.prototype.render=function(t,e){var o=new r(this.x,this.y,this.z),n=this.w*(1-e.isoGap);t.add(new s(o,n,n,this.h),this.color)},e.exports=o},{"../../bower_components/isomer/index.js":1}],11:[function(t,e){function o(t,e,o,r,s,i,a){n.call(this,t,e,o),this.d=r,this.w=s,this.c1=i,this.c2=a||i}var n=t("./verticalfeature"),r=t("../../bower_components/isomer"),s=(r.Point,r.Shape.Cylinder),i=t("../shapes/cone"),a=t("../shapes/ring");o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.prototype.renderAt=function(t,e){var o=this.d/2,n=this.w,r=n,h=(o+n)/Math.SQRT2,p=e.translate(0,0,this.h-this.w),l=e.translate(h,0-h,this.h);t.add(new a(p,o,7,this.w),this.c1),t.add(new s(l.translate(0,0,-2*r),n,14,2*r),this.c2),t.add(new i(l,n,14,r),this.c2)},e.exports=o},{"../../bower_components/isomer":1,"../shapes/cone":20,"../shapes/ring":21,"./verticalfeature":19}],12:[function(t,e){function o(t,e){this.origin(t),this.parent(e)}{var n=t("../../bower_components/isomer");n.Point}o.prototype.origin=function(t){if(void 0!==t){{new n.Point(t.x,t.y,t.z)}this._origin=t}return this._origin},o.prototype.parent=function(t){return t&&(this.p=t,this._origin.z=t.z),this.p},o.prototype.render=function(t,e){this.renderAt(t,this._origin,e)},o.prototype.renderAt=function(t,e){var o=.75,r=new n.Color(255,0,255);t.add(new n.Path.Star(e,o/6,o/2,7),r)},e.exports=o},{"../../bower_components/isomer":1}],13:[function(t,e){function o(t,e,o,r,s,i){n.call(this,t,e,o),this.w=r,this.c1=s,this.c2=i||s}var n=t("./verticalfeature"),r=t("../../bower_components/isomer"),s=(r.Point,r.Shape.Pyramid,r.Shape.Cylinder),i=t("../shapes/cone"),a=t("../shapes/ring");o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.prototype.renderAt=function(t,e){var o=this.w/2,n=this.w/50,r=(o-2*n)/Math.SQRT2,h=4*this.h/5,p=1*this.h/10,l=e.translate(r,-1*r,0),c=e.translate(-1*r,r,0),u=e.translate(0,0,this.h-h),d=e.translate(0,0,this.h-p);t.add(new s(l,n,6,this.h),this.c2),t.add(new s(c,n,6,this.h),this.c2),t.add(new i.Inverted.Open(u,o,15,h),this.c1),t.add(new a(d,o,7,p),this.c2)},e.exports=o},{"../../bower_components/isomer":1,"../shapes/cone":20,"../shapes/ring":21,"./verticalfeature":19}],14:[function(t,e){function o(t,e,o,r,s){n.call(this,t,e),this.dir=r,this.w=o,this.c=s}var n=t("./feature"),r=t("../../bower_components/isomer"),s="+x -x +y -y".split(" ");o.prototype=Object.create(n.prototype),o.prototype.constructor=o,n.prototype.validDir=function(t){return-1!=s.indexOf(t.toLowerCase())},n.prototype.direction=function(t){return t&&validDir(t.toLowerCase())&&(this.dir=t.toLowerCase()),this.dir},n.prototype.width=function(t){return t&&(this.w=t),this.w},n.prototype.color=function(t){return t&&(this.c=t),this.c},o.prototype.render=function(t,e){var o=r.Point,n=o(this.p.x+.5,this.p.y+.5,this.p.z),s=this.w/2,i=[n.translate(0-s,s,0),n.translate(0-s,0-s,0),n.translate(s,0-s,0),n.translate(s,s,0)];"+x"==this.dir&&(i[3]=n.translate(.5-e.isoGap,s,0),i[2]=n.translate(.5-e.isoGap,0-s,0)),"-x"==this.dir&&(i[1]=n.translate(-.5,0-s,0),i[0]=n.translate(-.5,s,0)),"+y"==this.dir&&(i[3]=n.translate(s,.5-e.isoGap,0),i[0]=n.translate(0-s,.5-e.isoGap,0)),"-y"==this.dir&&(i[2]=n.translate(s,-.5,0),i[1]=n.translate(0-s,-.5,0)),t.add(new r.Path(i),this.c),i.reverse(),"-x"==this.dir&&(i[0]=i[3].translate(0,0,-1e3),i[1]=i[2].translate(0,0,-1e3),t.add(new r.Path(i),this.c)),"-y"==this.dir&&(i[0]=i[1].translate(0,0,-1e3),i[3]=i[2].translate(0,0,-1e3),t.add(new r.Path(i),this.c))},o.prototype.renderAt=function(t,e,o){this.render(t,o)},e.exports=o},{"../../bower_components/isomer":1,"./feature":12}],15:[function(t,e){function o(t,e,o,r,s){n.call(this,t,e,o),this.b=r,this.c=s}var n=t("./verticalfeature"),r=t("../../bower_components/isomer"),s=(r.Point,r.Shape.Prism),i=r.Shape.Cylinder;o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.prototype.renderAt=function(t,e){var o=this.b,n=this.b,r=this.b/2,a=r/2,h=r/3,p=e.translate(-1*a,-1*a,this.h-o);t.add(new i(e,h,15,this.h-o),this.c),t.add(new s(p,n,r,o),this.c),t.add(new s(p,n,a-h,o),this.c)},e.exports=o},{"../../bower_components/isomer":1,"./verticalfeature":19}],16:[function(t,e){function o(t,e,o,n,s,i,a){r.call(this,t,e,o),this.w=n,this.c1=s,this.c2=i||s,this.c3=a||s}function n(t,e,o,n,s,i,a,h){r.call(this,t,e,o),this.l=n,this.w=s,this.a=i,this.c1=a,this.c2=h||a}var r=t("./verticalfeature"),s=t("../../bower_components/isomer"),i=s.Point,a=s.Shape.Prism,h=s.Shape.Cylinder,p=t("../shapes/ring");o.prototype=Object.create(r.prototype),o.prototype.constructor=o,o.prototype.renderAt=function(t,e){var o=this.w/2,n=3*this.w,r=this.w,s=n/2,i=this.w/10,l=this.h-r,c=(o+i)*Math.SQRT2+i,u=this.w/4,d=e.translate(0-s,0-s,0),f=e.translate(0+o,0+o,r),w=e.translate(0+o,0-o,r),y=e.translate(0-o,0+o,r),g=e.translate(0-o,0-o,r);t.add(new p(e.translate(0,0,this.h-u),c,12,u,!0),this.c3),t.add(new a(d,n,n,r),this.c2),t.add(new h(f,i,6,l),this.c1),t.add(new h(w,i,6,l),this.c1),t.add(new h(y,i,6,l),this.c1),t.add(new h(g,i,6,l),this.c1),t.add(new p(e.translate(0,0,this.h-u),c,12,u),this.c3)},n.prototype=Object.create(r.prototype),n.prototype.constructor=n,n.prototype.renderAt=function(t,e){console.log(this);var o=(this.l,this.w/2);this.a=Math.PI,console.log(o,this.l,this.w,this.a);var n=new a(i(0,0,this.h),this.l,this.w,this.w);return void t.add(n,this.c1)},e.exports={Boom:n,Base:o}},{"../../bower_components/isomer":1,"../shapes/ring":21,"./verticalfeature":19}],17:[function(t,e){function o(t,e,o,s,i,a,h){r.call(this,t,e,s),this.w=o,this.cTrunk=i,this.cLeaf=a,this.type=n,h&&(this.type=h)}var n,r=t("./verticalfeature"),s=t("../../bower_components/isomer"),i=(s.Point,s.Shape.Pyramid),a=s.Shape.Cylinder,h=t("../shapes/cone"),p=t("../shapes/ring"),l=(Math.random(),"pointy cylindrical stump combination umbrella random".split(" "));n=l[Math.floor(Math.random()*l.length)],n="umbrella",o.prototype=Object.create(r.prototype),o.prototype.constructor=o,o.prototype.renderAt=function(t,e){var o=this.type;if("random"==o){var n=[].concat(l);n.splice(l.indexOf("stump"),1),n.splice(l.indexOf("random"),1),o=n[Math.floor(Math.random()*n.length)]}if("pointy"==o){var r=2/3,s=4,c=2/3,u=1/3,d=0-this.w/1.41,f=e.translate(d,d,0),w=e.translate(d*s,d*s,this.h*u);t.add(new i(f,this.w,this.w,this.h*r),this.cTrunk),t.add(new i(w,this.w*s,this.w*s,this.h*c),this.cLeaf)}if("cylindrical"==o||"umbrella"==o){var r=2/3,s=5,u=2/3,c=1/3;"umbrella"==o&&(s=13,r=.75,u=.75,c=.25);var y=1*this.w,g=e.translate(0,0,this.h*u);t.add(new a(e,y,22,this.h*r),this.cTrunk);var m=y*s,b=5+22*m;t.add(new a(g,y*s,b,this.h*c),this.cLeaf)}if("canopytop"==o){var r=.5,s=10,u=r-.1,c=1-u,y=.5*this.w,v=y*s,_=this.h*c,x=4*_/6,P=e.translate(0,0,this.h*u),j=1*_/6,S=P.translate(0,0,x),M=1*_/6,z=S.translate(0,0,j);t.add(new p(e,y,11,this.h*r),this.cTrunk);var b=5+22*m;t.add(new h.Inverted.Open(P,v,b,x),this.cLeaf),t.add(new a(S,v,b,j),this.cLeaf),t.add(new h.Open(z,v,b,M),this.cLeaf)}if("stump"==o){var y=this.w;t.add(new a(e,y,33,this.h),this.cTrunk)}if("combination"==o){var r=.2,s=2,c=.8,u=.2,d=0-this.w/2,k=e.translate(d*s,d*s,this.h*u);t.add(new a(e,this.w/2,10,this.h*r),this.cTrunk),t.add(new i(k,this.w*s,this.w*s,this.h*c),this.cLeaf)}},e.exports=o},{"../../bower_components/isomer":1,"../shapes/cone":20,"../shapes/ring":21,"./verticalfeature":19}],18:[function(t,e){function o(t,e,o,r,s){n.call(this,t,e,o,1,r,s)}var n=t("./block");o.prototype=Object.create(n.prototype),o.prototype.constructor=o,e.exports=o},{"./block":10}],19:[function(t,e){function o(t,e,o){n.call(this,t,e),this.h=o}var n=t("./feature"),r=t("../../bower_components/isomer");o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.prototype.render=function(t,e){this.renderAt(t,this._origin,e)},o.prototype.renderAt=function(t,e){var o=.25,n=new r.Color(255,255,0),s=r.Shape.extrude(new r.Path.Star(e,o/6,o/2,11),this.h);t.add(s,n)},e.exports=o},{"../../bower_components/isomer":1,"./feature":12}],20:[function(t,e){var o=t("../../bower_components/isomer"),n=o.Path,r=o.Point,s=o.Shape,i=function(t,e,o,i,a,h){e="number"==typeof e?e:1,i="number"==typeof i?i:1,o=o||20,a=!!a,h=!!h;var p=new s,l=t.translate(0,0,i);a&&(t=l,l=t.translate(0,0,-1*i));var c,u=new n;for(c=0;o>c;c++)u.push(new r(e*Math.cos(2*c*Math.PI/o),e*Math.sin(2*c*Math.PI/o),0));u=u.translate(t.x,t.y,t.z),h||p.push(u);var d;for(c=1;o>c;c++)d=new n(a?[u.points[c],u.points[c-1],l]:[u.points[c-1],u.points[c],l]),p.push(d);return d=new n(a?[u.points[0],u.points[c-1],l]:[u.points[c-1],u.points[0],l]),p.push(d),p},a=function(t,e,o,n){return new i(t,e,o,n,!1,!1)};a.Inverted=function(t,e,o,n){return new i(t,e,o,n,!0,!1)},a.Open=function(t,e,o,n){return new i(t,e,o,n,!1,!0)},a.Inverted.Open=function(t,e,o,n){return new i(t,e,o,n,!0,!0)},a.Open.Inverted=function(t,e,o,n){return new i(t,e,o,n,!0,!0)},e.exports=a},{"../../bower_components/isomer":1}],21:[function(t,e){var o=t("../../bower_components/isomer"),n=o.Path,r=o.Point,s=o.Shape,i=function(t,e,o,i,a){e="number"==typeof e?e:1,i="number"==typeof i?i:1,o=o||20,a=!!a;var h=new s,p=new n,l=3*Math.PI/4;a&&(l=-1*Math.PI/4);var c;for(c=0;o+1>c;c++)p.push(new r(e*Math.cos(l+c*Math.PI/o),e*Math.sin(l+c*Math.PI/o),0));for(p=p.translate(t.x,t.y,t.z),c=1;o+1>c;c++)h.push(new n([p.points[c-1],p.points[c],p.points[c].translate(0,0,i),p.points[c-1].translate(0,0,i)]));return h};e.exports=i},{"../../bower_components/isomer":1}],22:[function(){"function"!=typeof Object.create&&!function(){var t=function(){};Object.create=function(e){if(arguments.length>1)throw Error("Second argument not supported");if(null===e)throw Error("Cannot set a null [[Prototype]]");if("object"!=typeof e)throw TypeError("Argument must be an object");return t.prototype=e,new t}}()},{}],23:[function(t,e){"use strict";var o=t("./worlddefaults.js"),n=t("./forestworld.js"),r=t("../../bower_components/isomer/index.js"),s={defaultOptions:o,Color:r.Color,Forest:n};window.World=s,e.exports=s},{"../../bower_components/isomer/index.js":1,"./forestworld.js":25,"./worlddefaults.js":26}],24:[function(t,e){function o(t,e){this._opts=Object.create(r),this.mergeOptions(e),this._squares=this.initSquares(),this._groundStacks=[],this._groundHeight=[],this._dom=this.resolveDom(t),this._layers=this.makeLayers(),this._colors=s[this._opts.colorScheme],void 0===this._colors&&(this._colors={blank:new i.Color(255,75,75,.66)}),this._opts.autoSize&&this.autoSize()}t("../util/shims.js");var n=t("./worlddefaults.js"),r=n.options,s=n.colorSchemes,i=t("../../bower_components/isomer/index.js"),a=i.Point,h=t("../objects/unitcolumn.js"),p=(t("../objects/feature.js"),t("../objects/verticalfeature.js")),l=t("../objects/pathfeature.js");o.prototype.autoSize=function(){var t=this._opts,e=this._layers.fg.canvas.width,o=this._layers.fg.canvas.height,n=this._squares.length,r=this._squares[0].length,s=t.maxH-t.minH,i=n+r,a=i*Math.cos(t.isoAngle),h=(i+2*this.wl2bl(s,!0))*Math.sin(t.isoAngle),p=o/h,l=e/a;t.isoScale=.99*Math.min(p,l);var c=Math.max(0,(e-t.isoScale*a)/2),u=Math.max(0,(o-t.isoScale*h)/2);t.isoOriginX=1.01*c+(e-c-c)*r/(n+r),t.isoOriginY=o-1.01*u,this._layers=this.makeLayers(),this.renderMaybe()},o.prototype.initSquares=function(){for(var t=[],e=this._opts,o=Math.ceil((e.maxX-e.minX)/e.blockSize),n=Math.ceil((e.maxY-e.minY)/e.blockSize),r=0;o>r;r++){t.push([]);for(var s=0;n>s;s++)t[r].push({x:r,y:s,z:0,ground:[],paths:[],features:[]})}return t},o.prototype.getColor=function(t){if(t instanceof i.Color)return t;var e=this._colors[t];return e||(e=this._colors.blank),e},o.prototype.resolveDom=function(t){return t instanceof Element?t:document.getElementById(t)},o.prototype.makeLayers=function(){var t=this._opts,e=this._dom.clientWidth,o=this._dom.clientHeight,n={scale:t.isoScale,angle:t.isoAngle};t.isoOriginX&&(n.originX=t.isoOriginX),t.isoOriginY&&(n.originY=t.isoOriginY),this._dom.innerHTML='<style>.isoworld { position: absolute; top: 0, bottom: 0, left: 0, right: 0 }</style><canvas id="isoworld-bg" class="isoworld" width="'+e+'" height="'+o+'"></canvas><canvas id="isoworld-fg" class="isoworld" width="'+e+'" height="'+o+'"></canvas><canvas id="isoworld-ui" class="isoworld" width="'+e+'" height="'+o+'"></canvas>';var r=new i(document.getElementById("isoworld-bg"),n),s=new i(document.getElementById("isoworld-fg"),n);n.lightPosition=new i.Vector(-1,-1,10),n.lightPosition=new i.Vector(-1,-1,10);var a=new i(document.getElementById("isoworld-ui"),n);return{bg:r,fg:s,ui:a}},o.prototype.mergeOptions=function(t){for(opt in t)this._opts[opt]=t[opt]},o.prototype.autoRender=function(t){return t===!1?this._opts.autoRender=!1:1==t&&(this._opts.autoRender=!0),this._opts.autoRender},o.prototype.wh2bh=function(t){return this.wl2bl(t-this._opts.minH,!0)},o.prototype.wl2bl=function(t,e){return e?t/this._opts.blockSize*this._opts.scaleH:t/this._opts.blockSize*(1-this._opts.isoGap)},o.prototype.w2b=function(t,e){var o=this._opts,n=1/o.blockSize;return e?t.scale(a.ORIGIN,n,n,n*o.scaleH):t.translate(0-o.minX,0-o.minY,0-o.minH).scale(a.ORIGIN,n,n,n*o.scaleH)},o.prototype.w2block=function(t){return this._block(this.w2b(t))},o.prototype._block=function(t){if(this._inBlockRange(t)){var e=Math.floor(t.x),o=Math.floor(t.y);return this._squares[e][o]}return!1},o.prototype._inBlockRange=function(t){return t.x>=0&&t.x<this._squares.length&&t.y>=0&&t.y<this._squares.length},o.prototype.feature=function(t,e){var o=this.w2b(t);e||(e=new p(o)),this._addFeature(o,e),this.renderMaybe()},o.prototype.addPath=function(t,e,o){for(var n,r,s=this.wl2bl(e),i=this.getColor(o),a=1;a<t.length;a++)n=this.w2b(t[a-1]),r=this.w2b(t[a]),this._pathBetween(n,r,s,i)},o.prototype._pathBetween=function(t,e,o,n){for(var r,s=this._block(t),i=new a(s.x,s.y,0),h=Math.min(1,o),p=this._block(e),c=(new a(p.x,p.y,0),p.x),u=p.y,d=s.x,f=s.y,w=d,y=f,g=Math.abs(c-d),m=Math.abs(u-f),b=c>d?1:-1,v=u>f?1:-1,_=g-m;d!=c||f!=u;)r=2*_,r>-m?(_-=m,w=d+b,oldDir=0>b?"-x":"+x",newDir=0>b?"+x":"-x"):g>r&&(_+=g,y=f+v,oldDir=0>v?"-y":"+y",newDir=0>v?"+y":"-y"),s.paths.push(new l(i,s,h,oldDir,n)),s=this._block(new a(w,y)),i=new a(s.x+.5,s.y+.5,0),s.paths.push(new l(i,s,h,newDir,n)),d=w,f=y;this.renderMaybe()},o.prototype._addFeature=function(t,e){if(this._inBlockRange(t)){var o=this._block(t);o.features.push(e),e.parent(o),o.features.sort("line"==this._opts.featurePosition?function(t,e){return e.h-t.h}:function(t,e){return e.origin().depth()-t.origin().depth()})}},o.prototype.ground=function(){if(1==arguments.length&&this._setGroundLevel(this.w2b(arguments[0])),2==arguments.length&&(this._setGroundLevel(this.w2b(arguments[0])),this._setGroundStack(this.w2b(arguments[0]),arguments[1])),3==arguments.length){var t=new a(arguments[0],arguments[1],0);this._setGroundStack(this.w2b(t),arguments[2])}this.renderMaybe()},o.prototype._listToStack=function(t,e){var o,n,r=[],s=0;for(listIndex=0;listIndex<t.length;listIndex+=2)o=this.getColor(t[listIndex]),n=listIndex<t.length-1?this.wl2bl(t[listIndex+1],!0):s-this.wh2bh(this._opts.bedrockH),n>0&&(s-=n,column=new h(e.x,e.y,s,n,o),r.unshift(column));return r},o.prototype._setGroundLevel=function(t){this._groundHeight.push(t)},o.prototype._setGroundStack=function(t,e){return this._inBlockRange(t)?(this._groundStacks.push({x:t.x,y:t.y,ground:this._listToStack(e,t)}),this._extrapolateGround(),!0):!1},o.prototype.renderSquare=function(t,e){this.renderSquareGround(t,e),this.renderSquarePaths(t,e),this.renderSquareFeatures(t,e)},o.prototype.renderSquareFeatures=function(t,e){var o=this._squares[t][e];if(void 0!==o&&o.features&&o.features.length>0)if("line"==this._opts.featurePosition){var n,r,s=this._opts.isoGap,i=(1-s)/(o.features.length+2),h=i/2;for(n=0;n<o.features.length;n++)r=o.features[n],h+=i,r.renderAt(this._layers.fg,new a(t+h,e+1-s-h,o.z),this._opts)}else{var n,r;for(n=0;n<o.features.length;n++)o.features[n].render(this._layers.fg,this._opts)}},o.prototype.renderSquarePaths=function(t,e){var o=this._squares[t][e];if(void 0!==o&&o.paths&&o.paths.length>0){var n,r;for(n=0;n<o.paths.length;n++)r=o.paths[n],r.render(this._layers.fg,this._opts)}},o.prototype.renderSquareGround=function(t,e){var o,n=this._squares[t][e];if(void 0!==n){var r,s;if(n.ground&&n.ground.length>0)for(var r=0;r<n.ground.length;r++)s=n.ground[r],s.render(this._layers.fg,this._opts);else o=this.wh2bh(this._opts.bedrockH),s=new h(t,e,o,(n.z?n.z:0)-o,this.getColor("blank")),s.render(this._layers.fg,this._opts)}},o.prototype.renderUI=function(){var t=this._layers.ui;t.canvas.clear();var e,o,n=this._squares.length,r=this._squares[0].length,s=this.wh2bh(this._opts.maxHeight)+.33;for(e=0;n>=e;e++)t.add(new i.Path(new a(e-.01,0,s),new a(e+.01,0,s),new a(e,r,s)),this.getColor("ui"));for(o=0;r>=o;o++)t.add(new i.Path(new a(0,o+.01,s),new a(0,o-.01,s),new a(n,o,s)),this.getColor("ui"))},o.prototype.renderFG=function(){this._layers.fg.canvas.clear();for(var t,e,o=this._squares,n=o.length,r=o[0].length,s=n+r-2;s>=0;){for(t=0;n>t;t++)for(e=0;r>e;e++)t+e==s&&o[t][e]&&this.renderSquare(t,e);s-=1}if(this._opts.showAxes){var a=100,h=.01,p=i.Point,l=new i.Color(255,0,0);this._layers.fg.add(new i.Path([new p(0,h,0),new p(0,0-h,0),new p(a,0,0)]),l),this._layers.fg.add(new i.Path([new p(0-h,0,0),new p(h,0,0),new p(0,a,0)]),l),this._layers.fg.add(new i.Path([new p(0-h,h,0),new p(h,0-h,0),new p(0,0,a)]),l)}},o.prototype.render=function(){this.renderFG(),this.renderUI()},o.prototype.renderMaybe=function(){this._autoRender&&this.render()},o.prototype._copyGround=function(t,e){var o,n=t.z,r=e.z-this.wh2bh(this._opts.bedrockH);void 0===n&&(n=0),e.ground=[];for(var s=t.ground.length-1;s>=0;s--)r>0&&(o=t.ground[s].dupe(),o.translate(e.x-t.x,e.y-t.y,e.z-n),r-=o.h,e.ground.unshift(o));e.ground[0].z-=r,e.ground[0].h+=r},o.prototype._extrapolateGround=function(){var t,e,o=this._squares,n=o.length,r=o[0].length;for(t=0;n>t;t++)for(e=0;r>e;e++)this._extrapolateGroundForSquare(o[t][e]);this.renderMaybe()},o.prototype._extrapolateGroundForSquare=function(t){for(var e,o,n,r,s,i=0,a=0,h=0;h<this._groundHeight.length;h++)r=this._groundHeight[h],e=t.x+.5-r.x,o=t.y+.5-r.y,n=1+e*e+o*o,s=1/n,i+=r.z*s,a+=s;i/=a;var p=this.wl2bl(this._opts.stepH,!0);t.z=Math.round(i/p)*p;for(var l,c,u,d=this._squares.length,f=this._squares[0].length,l=d*d+f*f,w=0;w<this._groundStacks.length;w++)c=this._groundStacks[w],e=t.x+.5-c.x,o=t.y+.5-c.y,n=e*e+o*o,l>n&&(l=n,u=c);u&&this._copyGround(u,t);for(var y=0;y<t.features.length;y++)t.features[y].parent(t)},e.exports=o},{"../../bower_components/isomer/index.js":1,"../objects/feature.js":12,"../objects/pathfeature.js":14,"../objects/unitcolumn.js":18,"../objects/verticalfeature.js":19,"../util/shims.js":22,"./worlddefaults.js":26}],25:[function(t,e){function o(t,e){n.call(this,t,e),e.treeType&&(this._treeType=e.treeType)}t("../util/shims");var n=t("./baseworld"),r=t("../objects/tree"),s=t("../objects/leaftrap"),i=t("../objects/soilpit"),a=t("../objects/dendrometer"),h=t("../objects/towercrane");o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.prototype.tree=function(t,e,o,n){var s=this.w2b(t),i=this.wl2bl(e),a=this.wl2bl(o,!0),h=this._treeType;h&&"stump"==h&&(a=this.wl2bl(2.5,!0)),h&&"stump"==h&&n&&(a=this.wl2bl(15,!0));var p=this.getColor("ui"),l=this.getColor("polywhite");"left"==n?this._addFeature(s,new r(s,null,i,a,p,p,h)):"right"==n?this._addFeature(s,new r(s,null,i,a,l,l,h)):this._addFeature(s,new r(s,null,i,a,this.getColor("wood"),this.getColor("foliage"),h))},o.prototype.leafTrap=function(t){var e=this.w2b(t),o=this.wl2bl(1.5),n=this.wl2bl(2,!0),r=new s(e,null,n,o,this.getColor("leaftrap"),this.getColor("steel"));this._addFeature(e,r)},o.prototype.soilPit=function(t){var e=this.w2b(t),o=this.wl2bl(1),n=this.wl2bl(2,!0),r=new i(e,null,n,o,this.getColor("polywhite"));this._addFeature(e,r)},o.prototype.dendrometer=function(t,e){var o=this.w2b(t),n=this.wl2bl(2,!0),r=this.wl2bl(e),s=this.wl2bl(.5,!0),i=new a(o,null,n,r,s,this.getColor("steel"),this.getColor("polywhite"));this._addFeature(o,i)},o.prototype.crane=function(t,e,o){var n=this.wl2bl(3),r=this.w2b(t.translate(-1.5*n,-1.5*n,0)),s=this.wl2bl(e,!0),i=(this.wl2bl(o),new h.Base(r,null,s,n,this.getColor("metal"),this.getColor("concrete"),this.getColor("polywhite")));this._addFeature(r,i)},e.exports=o},{"../objects/dendrometer":11,"../objects/leaftrap":13,"../objects/soilpit":15,"../objects/towercrane":16,"../objects/tree":17,"../util/shims":22,"./baseworld":24}],26:[function(t,e){var o=t("../../bower_components/isomer/index.js").Color,n=(t("../../bower_components/isomer/index.js").Point,{autoRender:!0,autoSize:!0,minX:0,maxX:10,minY:0,maxY:10,maxH:5,minH:-8,scaleH:1,stepH:.1,bedrockH:-16,featurePosition:"accurate",colorScheme:"bright",blockSize:1,isoGap:.05,isoScale:60,isoAngle:Math.PI/6,dummy:"has no trailing comma"}),r={bright:{blank:new o(180,180,180,.05),soil:new o(110,50,35),sand:new o(230,200,20),leaflitter:new o(90,110,50),water:new o(50,200,255,.75),wood:new o(90,50,20),foliage:new o(90,200,50,.66),gravel:new o(120,135,180),leaftrap:new o(50,50,50,.9),polywhite:new o(190,190,190),concrete:new o(130,130,130),steel:new o(170,180,220),metal:new o(60,60,80),ui:new o(255,255,0,.33),highlight:new o(255,255,100,.66)},real:{blank:new o(125,125,125),soil:new o(50,40,30),sand:new o(210,190,120),leaflitter:new o(50,60,40),water:new o(50,150,255,.75),wood:new o(50,40,30,.66),foliage:new o(90,200,50,.66),gravel:new o(120,135,180),leaftrap:new o(50,50,50),polywhite:new o(200,200,200),ui:new o(255,255,100,.33),highlight:new o(255,255,100,.66)}};e.exports={options:n,colorSchemes:r}},{"../../bower_components/isomer/index.js":1}]},{},[9])(9)});